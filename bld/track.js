javascript:(function(){var s=function(){function c(){return g.i("messagesWrapper")}function u(){return c().querySelector("[class*='scroller_']")}function a(){return c().querySelectorAll("[class*='message_']")}function l(t){var e=Object.keys(t||{}),n=e.find(t=>t.startsWith("__reactInternalInstance"));return n?t[n].memoizedProps:(n=e.find(t=>t.startsWith("__reactProps$")))?t[n]:null}function d(t){var e=l(t);if(e.children&&e.children.length)for(let t=3;t<e.children.length;t++){var n=e.children[t].props;if(n&&"message"in n&&"channel"in n)return n}return null}function h(){return null===document.querySelector("#messagesNavigationDescription + [class^=container]")}function f(){try{const e=[];for(const n of a())try{var t=d(n);null!=t&&e.push(t.message)}catch(t){console.error("[DHT] Error extracing message data, skipping it.",t,n,function(t){try{return this.o(t)}catch(t){return null}}(n))}return e}catch(t){return console.error("[DHT] Error retrieving messages.",t),[]}}return{l:function(s){let i=0,o=!1,a=!1;const l=new Set,t=window.setInterval(()=>{if(0<i)--i;else if(c()){var e=g.i("message",c());if(300<(e?e.parentElement.children.length:0)){if(o)return;i=3,o=!0,window.setTimeout(()=>{const t=u();t.scrollTop=t.scrollHeight/2},1)}else o=!1;e=f();let t=!1;for(const n of e)if(!l.has(n.id)){t=!0;break}if(t){l.clear();for(const r of e)l.add(r.id);a=!1,s(e)}else a||h()||(a=!0,s(!1))}else i=2},200);window.h.push(()=>window.clearInterval(t))},o:l,g:function(){try{let n;for(const e of a()){var t=d(e);if(null!=t){n=t.channel;break}}if(!n)return null;var r=g.i("privateChannels");if(r){let t;for(const i of r.querySelectorAll("[class*='channel_'] [class*='selected_'] [class^='name_'] *")){var s=Array.prototype.find.call(i.childNodes,t=>t.nodeType===Node.TEXT_NODE);if(s){t=s.nodeValue;break}}if(!t)return null;let e;switch(n.type){case 1:e="DM";break;case 3:e="GROUP";break;default:return null}return{server:t,channel:t,id:n.id,type:e,extra:{}}}if(n.guild_id){let t;for(const o of l(document.querySelector("nav header [class*='headerContent_']")).children)if(o&&o.props&&o.props.guild){t=o.props.guild;break}return t&&"string"==typeof t.name&&n.guild_id===t.id?{server:t.name,channel:n.name,id:n.id,type:"SERVER",extra:{position:n.position,topic:n.topic,nsfw:n.nsfw}}:null}return null}catch(t){return console.error(t),null}},p:f,v:()=>!!c(),k:h,S:function(){let t=u();0<t.scrollTop&&(t.scrollTop=0)},T:function(){var t=g.i("privateChannels");if(t){const e=g.i("selected",t);t=e&&e.closest("[class*='channel_']");const r=t&&t.nextElementSibling;if(!r||!r.getAttribute("class").includes("channel_"))return!1;const s=r.querySelector("a[href*='/@me/']");return s?(s.click(),s.scrollIntoView(!0),!0):!1}{const i=document.getElementById("channels");if(!i)return!1;function n(t){return t.querySelector("a[href^='/channels/'][role='link']")}const o=Array.prototype.filter.call(i.querySelectorAll("[class*='containerDefault']"),t=>null!==n(t));let e=null;for(let t=0;t<o.length-1;t++)if(o[t].className.includes("selected_")){e=o[t+1];break}if(null===e)return!1;const a=n(e);return a?(a.click(),e.scrollIntoView(!0),!0):!1}}}}(),g=function(){var s=(t,e,n,r)=>{t=document.createElement(t);return t.id=n||"",t.innerHTML=r||"",e.appendChild(t),t};return{id:(t,e)=>(e||document).getElementById(t),i:(t,e)=>(e||document).querySelector(`[class*="${t}_"]`),createElement:(t,e,n,r)=>s(t,e,n,r),C:t=>t.parentNode.removeChild(t),_:t=>s("style",document.head,"",t),O:(t,e)=>window.setTimeout(t,e),A:(t,e,n)=>t.addEventListener(e,n),M:(t,e,n)=>{n=new Date(Date.now()+1e3*n).toUTCString();document.cookie=t+"="+encodeURIComponent(JSON.stringify(e))+";path=/;expires="+n},N:t=>{t=document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)"+t+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1");return t.length?JSON.parse(decodeURIComponent(t)):null},D:(t,e)=>{var n=new Blob([e],{type:"octet/stream"});if("msSaveBlob"in window.navigator)return window.navigator.msSaveBlob(n,t);e=window.URL.createObjectURL(n),n=s("a",document.body);n.href=e,n.download=t,n.style.display="none",n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(e)}}}(),t=function(){function e(t){r||(h.R(n),d.F(n),r=!0),n("gui",t)}var o,a,l=()=>{h.$()?(o.I.U.disabled=!0,o.I.j.disabled=!0,o.I.P.disabled=!0):(o.I.U.disabled=!1,o.I.j.disabled=!1,o.I.H.disabled=o.I.P.disabled=!h.L())},n=(t,e)=>{var n,r,s,i;o&&(s="gui"===t&&"controller"===e,"data"!==t&&!s||l(),"tracking"!==t&&!s||(l(),o.I.G.innerHTML=h.$()?"Pause Tracking":"Start Tracking"),"data"!==t&&!s||(r=n=0,h.L()&&(n=h.V().J(),r=h.V().W()),o.I.B.innerHTML=[n," message",1===n?"":"s"," from ",r," channel",1===r?"":"s"].join(""))),a&&((s="gui"===t&&"settings"===e)&&(a.I.q.checked=d.autoscroll,a.I.X[d.afterFirstMsg].checked=!0,a.I.K[d.afterSavedMsg].checked=!0),"setting"!==t&&!s||(i=!d.autoscroll,Object.values(a.I.X).forEach(t=>t.disabled=i),Object.values(a.I.K).forEach(t=>t.disabled=i)))},r=!1,s={Y:function(){(o={}).Z=g._(` #app-mount { height: calc(100% - 48px) !important; } #dht-ctrl { position: absolute; bottom: 0; width: 100%; height: 48px; background-color: #FFF; z-index: 1000000; } #dht-ctrl button { height: 32px; margin: 8px 0 8px 8px; font-size: 16px; padding: 0 12px; background-color: #7289DA; color: #FFF; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.75); } #dht-ctrl button:disabled { background-color: #7A7A7A; cursor: default; } #dht-ctrl-close { margin: 8px 8px 8px 0 !important; float: right; } #dht-ctrl p { display: inline-block; margin: 14px 12px; } #dht-ctrl input { display: none; }`);var t=(t,e)=>"<button id='dht-ctrl-"+t+"'>"+e+"</button>";o.tt=g.createElement("div",document.body,"dht-ctrl",` ${t("upload","Upload &amp; Combine")} ${t("settings","Settings")} ${t("track","")} ${t("download","Download")} ${t("reset","Reset")} <p id='dht-ctrl-status'></p> <input id='dht-ctrl-upload-input' type='file' multiple> ${t("close","X")}`),o.I={U:g.id("dht-ctrl-upload"),j:g.id("dht-ctrl-settings"),G:g.id("dht-ctrl-track"),H:g.id("dht-ctrl-download"),P:g.id("dht-ctrl-reset"),et:g.id("dht-ctrl-close"),B:g.id("dht-ctrl-status"),nt:g.id("dht-ctrl-upload-input")},g.A(o.I.U,"click",()=>{o.I.nt.click()}),g.A(o.I.j,"click",()=>{s.rt()}),g.A(o.I.G,"click",()=>{h.st(!h.$())}),g.A(o.I.H,"click",()=>{h.it()}),g.A(o.I.P,"click",()=>{h.ot()}),g.A(o.I.et,"click",()=>{s.at(),window.h.forEach(t=>t()),window.DHT_LOADED=!1}),g.A(o.I.nt,"change",()=>{Array.prototype.forEach.call(o.I.nt.files,e=>{var n=new FileReader;n.onload=function(){var t={};try{t=JSON.parse(n.result)}catch(t){return alert("Could not parse '"+e.name+"', see console for details."),void console.error(t)}c.lt(t)?h.ct(e.name,new c(t)):alert("File '"+e.name+"' has an invalid format.")},n.readAsText(e,"UTF-8")}),o.I.nt.value=null}),e("controller")},at:function(){o&&(g.C(o.tt),g.C(o.Z),o=null)},rt:function(){(a={}).Z=g._(` #dht-cfg-overlay { position: absolute; left: 0; top: 0; width: 100%; height: 100%; background-color: #000; opacity: 0.5; display: block; z-index: 1000001; } #dht-cfg { position: absolute; left: 50%; top: 50%; width: 800px; height: 262px; margin-left: -400px; margin-top: -131px; padding: 8px; background-color: #fff; z-index: 1000002; } #dht-cfg-note { margin-top: 22px; } #dht-cfg sub { color: #666; font-size: 13px; }`),a.ut=g.createElement("div",document.body,"dht-cfg-overlay"),g.A(a.ut,"click",()=>{s.dt()});var t=(t,e,n)=>"<label><input id='dht-cfg-"+t+"-"+e+"' name='dht-"+t+"' type='radio'> "+n+"</label><br>";a.tt=g.createElement("div",document.body,"dht-cfg",` <label><input id='dht-cfg-autoscroll' type='checkbox'> Autoscroll</label><br> <br> <label>After reaching the first message in channel...</label><br> ${t("afm","nothing","Do Nothing")} ${t("afm","pause","Pause Tracking")} ${t("afm","switch","Switch to Next Channel")} <br> <label>After reaching a previously saved message...</label><br> ${t("asm","nothing","Do Nothing")} ${t("asm","pause","Pause Tracking")} ${t("asm","switch","Switch to Next Channel")} <p id='dht-cfg-note'> It is recommended to disable link and image previews to avoid putting unnecessary strain on your browser.<br><br> <sub>v.31f, released 20 November 2023</sub> </p>`),a.I={q:g.id("dht-cfg-autoscroll"),X:{},K:{}},a.I.X[u.ht]=g.id("dht-cfg-afm-nothing"),a.I.X[u.ft]=g.id("dht-cfg-afm-pause"),a.I.X[u.gt]=g.id("dht-cfg-afm-switch"),a.I.K[u.ht]=g.id("dht-cfg-asm-nothing"),a.I.K[u.ft]=g.id("dht-cfg-asm-pause"),a.I.K[u.gt]=g.id("dht-cfg-asm-switch"),a.I.q.addEventListener("change",()=>{d.autoscroll=a.I.q.checked}),Object.keys(a.I.X).forEach(t=>{g.A(a.I.X[t],"click",()=>{d.afterFirstMsg=t})}),Object.keys(a.I.K).forEach(t=>{g.A(a.I.K[t],"click",()=>{d.afterSavedMsg=t})}),e("settings")},dt:function(){a&&(g.C(a.ut),g.C(a.tt),g.C(a.Z),a=null)}};return s}();class c{constructor(t){var e=this;c.lt(t)||(t={meta:{},data:{}}),e.meta=t.meta,e.data=t.data,e.meta.users=e.meta.users||{},e.meta.userindex=e.meta.userindex||[],e.meta.servers=e.meta.servers||[],e.meta.channels=e.meta.channels||{},e.vt={wt:{},bt:new Set,kt:new Set,yt:new Set}}static lt(t){return t&&"object"==typeof t.meta&&"object"==typeof t.data}St(e,t,n,r){var s=e in this.meta.users,i=s?this.meta.users[e]:{};return i.name=t,n&&(i.tag=n),r&&(i.avatar=r),s?e in this.vt.wt?this.vt.wt[e]:this.vt.wt[e]=this.meta.userindex.findIndex(t=>t==e):(this.meta.users[e]=i,this.meta.userindex.push(e),this.vt.wt[e]=this.meta.userindex.length-1)}xt(e,n){var t=this.meta.servers.findIndex(t=>t.name===e&&t.type===n);return-1===t?(this.meta.servers.push({name:e,type:n}),this.meta.servers.length-1):t}Tt(t,e,n,r){if(this.meta.servers[t]){var s=e in this.meta.channels,t=s?this.meta.channels[e]:{server:t};return t.name=n,r.position&&(t.position=r.position),r.topic&&(t.topic=r.topic),r.nsfw&&(t.nsfw=r.nsfw),!s&&(this.meta.channels[e]=t,this.vt.bt.add(e),!0)}}Ct(t,e,n){var r=this.data[t]||(this.data[t]={}),t=e in r;return r[e]=n,this.vt.kt.add(e),!t}_t(t){var e=t.author,e={u:this.St(e.id,e.username,e.bot?null:e.discriminator,e.avatar),t:t.timestamp.toDate().getTime()};return 0<t.content.length&&(e.m=t.content),null!==t.editedTimestamp&&(e.te=t.editedTimestamp.toDate().getTime()),0<t.embeds.length&&(e.e=t.embeds.map(t=>{let e={url:t.url,type:t.type};return"rich"===t.type&&Array.isArray(t.title)&&1===t.title.length&&"string"==typeof t.title[0]&&(e.t=t.title[0],Array.isArray(t.description)&&1===t.description.length&&"string"==typeof t.description[0]&&(e.d=t.description[0])),e})),0<t.attachments.length&&(e.a=t.attachments.map(t=>({url:t.url}))),null!==t.messageReference&&(e.r=t.messageReference.message_id),0<t.reactions.length&&(e.re=t.reactions.map(t=>{let e={c:t.count,n:t.emoji.name};return null!==t.emoji.id&&(e.id=t.emoji.id),t.emoji.animated&&(e.an=!0),e})),e}Ot(t){return this.vt.yt.has(t)}At(t,e){var n,r=!1;for(n of e){var s=n.type;0!==s&&19!==s||"SENT"!==n.state||!this.Ct(t,n.id,this._t(n))||(this.vt.yt.add(n.id),r=!0)}return r}W(){return this.vt.bt.size}J(){return this.vt.kt.size}Mt(t){var e,n,r,s={},i=!1;for(e in t.meta.users){var o=t.meta.users[e];s[t.meta.userindex.findIndex(t=>t==e)]=this.St(e,o.name,o.tag,o.avatar)}for(n in t.meta.channels){var a=t.meta.servers[t.meta.channels[n].server],l=t.meta.channels[n];this.Tt(this.xt(a.name,a.type),n,l.name,l)}for(n in t.data)for(r in l=t.data[n]){var c=l[r];(o=c.u)in s?(c.u=s[o],this.Ct(n,r,c)):(i||(i=!0,alert("The uploaded archive appears to be corrupted, some messages will be skipped. See console for details."),console.error("User list:",t.meta.users),console.error("User index:",t.meta.userindex),console.error("Generated mapping:",s),console.error("Missing user for the following messages:")),console.error(c))}}Nt(){return JSON.stringify({meta:this.meta,data:this.data})}}var u={ht:"optNothing",ft:"optPause",gt:"optSwitch"},r=!1,d=function(){function s(){g.M("DHT_SETTINGS",e,15768e4)}function t(e,n,t){var r="_"+n;Object.defineProperty(e,n,{get:()=>e[r],set:t=>{e[r]=t,function(t,e){for(var n of i)n(t,e);s()}("setting",n)}}),e[r]=t}var e={},i=[],n=g.N("DHT_SETTINGS");return n||(n={_autoscroll:!0,_afterFirstMsg:u.ft,_afterSavedMsg:u.ft},r=!0),t(e,"autoscroll",n._autoscroll),t(e,"afterFirstMsg",n._afterFirstMsg),t(e,"afterSavedMsg",n._afterSavedMsg),e.F=function(t){i.push(t)},r&&s(),e}(),h=function(){function i(t,e){for(var n of r)n(t,e)}var r=[];return new class{constructor(){this.ot()}ot(){this.Dt=null,this.Rt=!1,this.Ft=null,i("data","reset")}V(){return this.Dt||(this.Dt=new c),this.Dt}L(){return null!=this.Dt}$(){return this.Rt}st(t){this.Rt=t,i("tracking",t)}ct(t,e){this.Ft=t,this.V().Mt(e),i("data","upload")}it(){this.L()&&g.D(this.Ft||"dht.txt",this.Dt.Nt())}$t(t,e,n,r,s){e=this.V().xt(t,e);!0===this.V().Tt(e,n,r,s)&&i("data","channel")}Ut(t,e){return!!this.V().At(t,e)&&(i("data","messages"),!0)}Ot(t){return this.V().Ot(t)}R(t){r.push(t)}}}();const e=window.location.href;if(!e.includes("discord.com/")&&!e.includes("discordapp.com/")&&!confirm("Could not detect Discord in the URL, do you want to run the script anyway?"))return;if(window.DHT_LOADED)return void alert("Discord History Tracker is already loaded.");window.DHT_LOADED=!0,window.h=[];let i=new Set,o=null,a=function(t){i.add("stopping"),g.O(()=>{h.st(!1),i.delete("stopping"),t&&t()},200)};s.l(t=>{if(h.$()&&0===i.size){let n=s.g();if(n)if(h.$t(n.server,n.type,n.id,n.channel,n.extra),!1===t||t.length){var r=!1!==t&&h.Ut(n.id,t);if(d.autoscroll){let e=null;!1===t?e=d.afterFirstMsg:r||h.Ot(t[0].id)||(e=d.afterSavedMsg),null===e?o=r?(s.S(),window.clearTimeout(o),null):window.setTimeout(s.S,2500):(i.add("stalling"),g.O(()=>{i.delete("stalling");var t=s.g();!t||t.id!==n.id||null!=(t=s.p())&&h.Ut(n.id,t),(e!==u.gt||s.T())&&e!==u.ft||h.st(!1)},250))}}else s.S();else a()}}),h.R((t,e)=>{"tracking"===t&&e&&((t=s.g())?null!=(e=s.p())?(h.$t(t.server,t.type,t.id,t.channel,t.extra),h.Ut(t.id,e),d.autoscroll&&s.v()&&(s.k()?s.S():((e=d.afterFirstMsg)!==u.gt||s.T())&&e!==u.ft||a())):a(()=>alert("Cannot see any messages.")):a(()=>alert("The selected channel is not visible in the channel list.")))}),t.Y(),r&&t.rt();})()